
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#0d1117">
    <link rel="apple-touch-icon" href="icons/icon-192.png">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta charset="UTF-8" />
    <title>Training Dashboard</title>

    <!-- ============================
         MODULAR CSS FILES
    ============================ -->
    <link rel="stylesheet" href="css/theme.css">
    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/cards.css">
    <link rel="stylesheet" href="css/badges.css">
    <link rel="stylesheet" href="css/calendar.css">
    <link rel="stylesheet" href="css/zwift.css">
    <link rel="stylesheet" href="css/mobile.css">
    
    <!-- TEMPORARY: restore full styling -->
    <link rel="stylesheet" href="css/legacy.css">

</head>

<body>

    <div class="tabs">
        <button class="tab-button active" onclick="openTab(event, 'main-tab')">Dashboard</button>
        <button class="tab-button" onclick="openTab(event, 'charts-tab')">Charts</button>
    </div>

    <div id="main-tab" class="tab-content active">
        <div class="container">

        <script>
        function saveHoursAndRebuild() {
            const value = document.getElementById("hours_input").value;
            document.getElementById("save_status").innerText = "Saving…";

            window.location.href = `mytrainingapp://save_and_rebuild?value=${value}`;

            setTimeout(() => {
                location.reload();
            }, 2000);
        }
        </script>

        
<div class="header-card">
  <div class="header-info" style="display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; gap:24px;">

    <!-- LEFT SIDE: Avatar + Athlete Info -->
    <div style="flex:1; min-width:300px;">
      <div style="display:flex; align-items:center; gap:16px; margin-bottom:8px;">
        <div class="header-avatar">
          <img src="https://dgalywyr863hv.cloudfront.net/pictures/athletes/232271/13378637/4/large.jpg" alt="Athlete photo" />
        </div>
        <div style="font-size:1.8em; font-weight:600;">Training Dashboard</div>
       
      </div>

      <div class="header-meta" style="margin-bottom:8px;">
        Steve "Chip” Chmiewliski · Taunton
      </div>

      <div class="header-metrics" style="display:grid; grid-template-columns:repeat(auto-fit, minmax(120px, 1fr)); gap:12px;">
        <div><div class="header-metric-label">Last Training Day</div><div class="header-metric-value">2026-02-09</div></div>
        <div><div class="header-metric-label">History Days</div><div class="header-metric-value">95</div></div>
        <div><div class="header-metric-label">CTL</div><div class="header-metric-value">92.2</div></div>
        <div><div class="header-metric-label">ATL</div><div class="header-metric-value">120.3</div></div>
        <div><div class="header-metric-label">TSB</div><div class="header-metric-value">-28.1</div></div>
        <div><div class="header-metric-label">Weekly TSS</div><div class="header-metric-value">84.1</div></div>
        <div><div class="header-metric-label">FTP</div><div class="header-metric-value">260 W</div></div>
        <div><div class="header-metric-label">Latest Sync</div><div class="header-metric-value">2026-02-09</div></div>
        <div><div class="header-metric-label">Training hours</div><div class="header-metric-value">10.0</div></div>
      </div>
    </div>

    <!-- RIGHT SIDE: Controls -->
    <div style="display:flex; flex-direction:column; align-items:flex-end; gap:6px;">
      <div style="display:flex; align-items:center; gap:8px;">
        
        <input id="hours_input" type="number" step="0.5" class="hours-input" placeholder="Enter hours"/>

        <button onclick="saveHoursAndRebuild()" class="save-button">
            Save & Rebuild
        </button>

        <span id="save_status"></span>
      </div>
      <p id="save_status" class="small" style="text-align:right; margin:0;"></p>
    </div>

  </div>

  <script>
  function saveHours() {
    const hours = document.getElementById("available_hours_input").value;
    const status = document.getElementById("save_status");
    status.innerText = "Saving…";
    window.location.href = "mytrainingapp://save_hours?value=" + hours;

    setTimeout(() => {
      status.innerText = "Saved ✔";
      setTimeout(() => {
        status.innerText = "";
      }, 2000);
    }, 1000);
  }
  </script>
</div>

        
    <div class="card training-load">
        <h2>Training Load Status</h2>
        <h3>Training Readiness</h3><p><strong>Score:</strong> 40/100 <span style='background:#e74c3c;padding:4px 8px;border-radius:6px;font-size:0.85em;'>Low</span></p><p><strong>Time to Fresh:</strong> 5 days</p><p><strong>Time to Peak:</strong> 7 days</p><h3>Load Status</h3><p><strong>Status:</strong> <span class='status-tired'>Tired</span></p><p><strong>TSB Trend (7 days, no load):</strong> -13.1 → 41.0</p><p>1 days since last activity</p><p>You’re under significant load. Plan lighter sessions or recovery soon.</p>
    </div>
    
        
    <div class="card fatigue-card">
        <h2>Fatigue (Hybrid)</h2>
        <p><strong>TSB:</strong> -13.1 <span class="badge badge-Fatigued">bad</span></p><p><strong>CTL:</strong> 90.0</p><p><strong>ATL:</strong> 103.2</p><h3>7‑Day Fatigue Forecast</h3><ul><li>Day 1: TSB -13.1</li><li>Day 2: TSB -0.5</li><li>Day 3: TSB 10.0</li><li>Day 4: TSB 18.8</li><li>Day 5: TSB 26.1</li><li>Day 6: TSB 32.1</li><li>Day 7: TSB 37.0</li></ul><h3>Next 3 Days: Suggested Sessions</h3><ul><li>Endurance</li><li>Tempo</li><li>Sweet spot</li></ul>
    </div>
    
        
    <div class="card race-readiness-card">
        <h2>Race Readiness & Load Projection</h2>
        <h3>Current Load & Fatigue</h3><p><strong>CTL:</strong> 90.0 <span style='background:#e74c3c;padding:4px 8px;border-radius:6px;font-size:0.85em;'>Below Target</span></p><p><strong>CTL Trend (7 days):</strong> <span style='color:#2ecc71;font-size:1.2em;'>▲</span></p><p><strong>ATL:</strong> 103.2</p><p><strong>TSB:</strong> -13.1 <span style='background:#e74c3c;padding:4px 8px;border-radius:6px;font-size:0.85em;'>Fatigued</span></p><h3>CTL Position vs Scenarios</h3>
        <div style='width:100%;background:#333;border-radius:6px;height:12px;margin:6px 0;'>
            <div style='width:0%;height:12px;border-radius:6px;
                        background:linear-gradient(90deg,#e74c3c,#f1c40f,#2ecc71);'>
            </div>
        </div>
        <div style='display:flex;justify-content:space-between;font-size:0.8em;opacity:0.8;'>
            <span>Maintain (97.2)</span>
            <span>Build (104.2)</span>
            <span>Aggressive (110.2)</span>
        </div>
        <h3>Race Readiness</h3><p><strong>Score:</strong> 62/100 <span style='background:#f1c40f;padding:4px 8px;border-radius:6px;font-size:0.85em;'>Building</span></p><h3>Performance Window</h3><p><strong>Status:</strong> <span class='badge pw-not-ready'>Not Yet</span></p><p>You need more recovery before peak performance.</p><h3>Load Ramp Safety</h3><p><strong>Ramp Rate:</strong> <span class='badge ramp-safe'>3.8 CTL/week</span></p><p>Ramp rate is within safe limits.</p><h3>CTL Projection to Race Day (23/04/2026)</h3><table class='ctl-projection'><tr><th>Scenario</th><th>Race Day CTL</th></tr><tr><td>Maintain</td><td>97.2</td></tr><tr><td>Build</td><td>104.2</td></tr><tr><td>Aggressive</td><td>110.2</td></tr></table>
    </div>
    
        
        
    <div class="card">
        <h2>Weekly Load & Availability</h2>

        <div class="summary-grid">
            <div><strong>Available:</strong> 10.0h</div>
            <div><strong>Scheduled:</strong> 8.79h</div>
            <div><strong>Actual:</strong> 1.29h</div>
            <div><strong>Remaining:</strong> 1.21h</div>
        </div>

        <hr>

        <div class="summary-grid">
            <div><strong>Target TSS:</strong> 420.0</div>
            <div><strong>Actual TSS:</strong> 84.12</div>
            <div><strong>Remaining TSS:</strong> 335.88</div>
        </div>

        <hr>

        <h3>Recommended Sessions</h3>
        
    <div class="card adaptive-load-summary">
        <h2>Recommended Sessions</h2>
        <p><strong>Target TSS: 420</strong></p>
        <p><strong>Available Hours:</strong> 10.0h</p>
        <p><strong>Scheduled:</strong> 8.79h</p>
        <p><strong>Remaining:</strong> 1.21h</p>
        <ul><li><strong>Endurance</strong> — Z2 steady ride (60 TSS)</li><li><strong>VO2 Max</strong> — Z5 intervals to drive fitness (80 TSS)</li></ul><p><strong>Remaining TSS to fill:</strong> 195</p>
    </div>
    
    </div>
    
        
    <div class="card" style="grid-column: 1 / -1;">
    
    <div class="card week-calendar">
        <h2>Week Calendar</h2>
        <div class="week-calendar-grid">
    
        <div class="week-cell">
            <div class="week-day-label">Monday</div>
            
                    <div class="week-session-text zone-tempo actual-session">
                        <strong>Actual:</strong> Zwift - The Greenway in New York<br><span class='small'>58m</span><br><span class='small why-session'></span><br><span class='small'>207.3 W (3.22 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Tempo</div>
                    </div>
                
                    <div class="week-session-text zone-recovery actual-session">
                        <strong>Actual:</strong> Zwift - Pacer Group Ride: Ocean Lava Cliffside Loop in Watopia with Coco<br><span class='small'>19m</span><br><span class='small why-session'></span><br><span class='small'>128.0 W (1.99 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Recovery</div>
                    </div>
                
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Tuesday</div>
            
                    <div class="week-session-text zone-race planned-session">
                        <strong>Planned:</strong> WTRL Race – Zwift<br><span class='small'>1h</span><br><span class='small why-session'>Key intensity session to maintain or improve race‑specific fitness. Contributes about 95 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span>
                        <div class="badge" style="margin-top:4px;">Race</div>
                    </div>
                
                    <div class="week-session-text zone-race planned-session">
                        <strong>Planned:</strong> WTRL Race a Zwift
                    <div class='zwo-tooltip'>
                        <span class='zwo-file-name'>ZWO: 2026-02-10_tuesday_WTRL_Race_a_Zwift.zwo</span>
                        <a class='btn-download' href='/generated_workouts/2026-02-10_tuesday_WTRL_Race_a_Zwift.zwo' download='2026-02-10_tuesday_WTRL_Race_a_Zwift.zwo'>
                            <img src='/icons/zwift.png' class='zwift-icon'>Download ZWO
                        </a>
                        <div class='tooltip-content' id='tooltip-2026-02-10_tuesday_WTRL_Race_a_Zwift' data-json='2026-02-10_tuesday_WTRL_Race_a_Zwift.json'>Loading…</div>
                    </div>
                    <div class='inline-preview' id='inline-2026-02-10_tuesday_WTRL_Race_a_Zwift'></div><br><span class='small'>1h</span><br><span class='small why-session'>Key intensity session to maintain or improve race‑specific fitness. Contributes about 60 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span>
                        <div class="badge" style="margin-top:4px;">Race</div>
                    </div>
                
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Wednesday</div>
            <strong>Wednesday</strong>: Rest
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Thursday</div>
            
                    <div class="week-session-text zone-threshold planned-session">
                        <strong>Planned:</strong> Zwift GainTrain – Threshold<br><span class='small'>1h</span><br><span class='small why-session'>Key intensity session to maintain or improve race‑specific fitness. Contributes about 85 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span><br><span class='small'>247–273 W</span><br><span class='small'>(3.83–4.24 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Threshold</div>
                    </div>
                
                    <div class="week-session-text zone-threshold planned-session">
                        <strong>Planned:</strong> Zwift GainTrain a Threshold
                    <div class='zwo-tooltip'>
                        <span class='zwo-file-name'>ZWO: 2026-02-12_thursday_Zwift_GainTrain_a_Threshold.zwo</span>
                        <a class='btn-download' href='/generated_workouts/2026-02-12_thursday_Zwift_GainTrain_a_Threshold.zwo' download='2026-02-12_thursday_Zwift_GainTrain_a_Threshold.zwo'>
                            <img src='/icons/zwift.png' class='zwift-icon'>Download ZWO
                        </a>
                        <div class='tooltip-content' id='tooltip-2026-02-12_thursday_Zwift_GainTrain_a_Threshold' data-json='2026-02-12_thursday_Zwift_GainTrain_a_Threshold.json'>Loading…</div>
                    </div>
                    <div class='inline-preview' id='inline-2026-02-12_thursday_Zwift_GainTrain_a_Threshold'></div><br><span class='small'>1h</span><br><span class='small why-session'>Key intensity session to maintain or improve race‑specific fitness. Contributes about 75 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span><br><span class='small'>247–273 W</span><br><span class='small'>(3.83–4.24 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Threshold</div>
                    </div>
                
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Friday</div>
            <strong>Friday</strong>: Rest
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Saturday</div>
            
                    <div class="week-session-text zone-endurance planned-session">
                        <strong>Planned:</strong> Endurance Ride – 3.5h<br><span class='small'>3h 30m</span><br><span class='small why-session'>Supports aerobic base and recovery without adding excessive fatigue. Contributes about 155 TSS. Fits within your current time budget at ~3.5h. Helps close most of your remaining TSS gap.</span><br><span class='small'>146–195 W</span><br><span class='small'>(2.27–3.03 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Endurance</div>
                    </div>
                
                    <div class="week-session-text zone-endurance planned-session">
                        <strong>Planned:</strong> Endurance Ride a 3.5h
                    <div class='zwo-tooltip'>
                        <span class='zwo-file-name'>ZWO: 2026-02-14_saturday_Endurance_Ride_a_3.5h.zwo</span>
                        <a class='btn-download' href='/generated_workouts/2026-02-14_saturday_Endurance_Ride_a_3.5h.zwo' download='2026-02-14_saturday_Endurance_Ride_a_3.5h.zwo'>
                            <img src='/icons/zwift.png' class='zwift-icon'>Download ZWO
                        </a>
                        <div class='tooltip-content' id='tooltip-2026-02-14_saturday_Endurance_Ride_a_3.5h' data-json='2026-02-14_saturday_Endurance_Ride_a_3.5h.json'>Loading…</div>
                    </div>
                    <div class='inline-preview' id='inline-2026-02-14_saturday_Endurance_Ride_a_3.5h'></div><br><span class='small'>3h 30m</span><br><span class='small why-session'>Supports aerobic base and recovery without adding excessive fatigue. Contributes about 60 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span><br><span class='small'>146–195 W</span><br><span class='small'>(2.27–3.03 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Endurance</div>
                    </div>
                
        </div>
        
        <div class="week-cell">
            <div class="week-day-label">Sunday</div>
            
                    <div class="week-session-text zone-endurance planned-session">
                        <strong>Planned:</strong> Endurance Ride – 2h<br><span class='small'>2h</span><br><span class='small why-session'>Supports aerobic base and recovery without adding excessive fatigue. Contributes about 90 TSS. Fits within your current time budget at ~2.0h. Helps close most of your remaining TSS gap.</span><br><span class='small'>146–195 W</span><br><span class='small'>(2.27–3.03 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Endurance</div>
                    </div>
                
                    <div class="week-session-text zone-endurance planned-session">
                        <strong>Planned:</strong> Endurance Ride a 2h
                    <div class='zwo-tooltip'>
                        <span class='zwo-file-name'>ZWO: 2026-02-15_sunday_Endurance_Ride_a_2h.zwo</span>
                        <a class='btn-download' href='/generated_workouts/2026-02-15_sunday_Endurance_Ride_a_2h.zwo' download='2026-02-15_sunday_Endurance_Ride_a_2h.zwo'>
                            <img src='/icons/zwift.png' class='zwift-icon'>Download ZWO
                        </a>
                        <div class='tooltip-content' id='tooltip-2026-02-15_sunday_Endurance_Ride_a_2h' data-json='2026-02-15_sunday_Endurance_Ride_a_2h.json'>Loading…</div>
                    </div>
                    <div class='inline-preview' id='inline-2026-02-15_sunday_Endurance_Ride_a_2h'></div><br><span class='small'>2h</span><br><span class='small why-session'>Supports aerobic base and recovery without adding excessive fatigue. Contributes about 60 TSS. Fits within your current time budget at ~1.0h. Helps close most of your remaining TSS gap.</span><br><span class='small'>146–195 W</span><br><span class='small'>(2.27–3.03 W/kg)</span>
                        <div class="badge" style="margin-top:4px;">Endurance</div>
                    </div>
                
        </div>
        </div></div>
    </div>
    

        <div class="collapsible-card-header" onclick="toggleCard('prev-week')">
            ▶ Previous Week
        </div>
        <div class="collapsible-card-content" id="prev-week" style="display:none;">
            <h2>Previous Week</h2><div class='week-grid'><div class='day-column'><strong>Monday</strong><br>
                <div class="session-card zone-tempo">
                    <strong>2026-02-09</strong><br>
                    Zwift - The Greenway in New York<br>
                    0h 58m<br>
                    [tempo] Contributes about 75 TSS at 207 W. Fits within your current time budget at ~1.0h.
                </div>
                
                <div class="session-card zone-recovery">
                    <strong>2026-02-09</strong><br>
                    Zwift - Pacer Group Ride: Ocean Lava Cliffside Loop in Watopia with Coco<br>
                    0h 19m<br>
                    [recovery] Contributes about 9 TSS at 128 W. Fits within your current time budget at ~0.3h.
                </div>
                </div><div class='day-column'><strong>Tuesday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Wednesday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Thursday</strong><br>
                <div class="session-card zone-endurance">
                    <strong>2026-02-05</strong><br>
                    Zwift - Pacer Group Ride: The Magnificent 8 in Watopia with Coco<br>
                    0h 22m<br>
                    [endurance] Contributes about 21 TSS at 186 W. Fits within your current time budget at ~0.4h.
                </div>
                
                <div class="session-card zone-threshold">
                    <strong>2026-02-05</strong><br>
                    Zwift - Group Ride:  Hotchillee Gain Train  (B) on The 6 Train in New York<br>
                    0h 47m<br>
                    [threshold] Contributes about 70 TSS at 231 W. Fits within your current time budget at ~0.8h.
                </div>
                
                <div class="session-card zone-endurance">
                    <strong>2026-02-05</strong><br>
                    Zwift - Watopia<br>
                    0h 26m<br>
                    [endurance] Contributes about 19 TSS at 161 W. Fits within your current time budget at ~0.4h.
                </div>
                </div><div class='day-column'><strong>Friday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Saturday</strong><br>
                <div class="session-card zone-threshold">
                    <strong>2026-02-07</strong><br>
                    Zwift - Glyph Heights in Watopia<br>
                    0h 58m<br>
                    [threshold] Contributes about 94 TSS at 233 W. Fits within your current time budget at ~1.0h.
                </div>
                
                <div class="session-card zone-recovery">
                    <strong>2026-02-07</strong><br>
                    Zwift - Pacer Group Ride: Loop de Loop in Watopia with Miguel<br>
                    0h 20m<br>
                    [recovery] Contributes about 9 TSS at 123 W. Fits within your current time budget at ~0.3h.
                </div>
                </div><div class='day-column'><strong>Sunday</strong><br><div class='session-card zone-rest'>Rest</div></div></div><p><strong>Total TSS:</strong> 299<br><strong>Total Duration:</strong> 4h 10m</p><p><strong>Intensity Summary:</strong> Well-balanced week across multiple zones.</p>
        </div>

        <div class="collapsible-card-header" onclick="toggleCard('next-week')">
            ▶ Next Week Plan
        </div>
        <div class="collapsible-card-content" id="next-week" style="display:none;">
            <h2>Next Week Plan</h2><div class='week-grid'><div class='day-column'><strong>Monday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Tuesday</strong><br>
                <div class="session-card zone-race">
                    <strong>WTRL Race – Zwift</strong><br>
                    1.0h — 95 TSS<br>
                    Race
                </div>
                </div><div class='day-column'><strong>Wednesday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Thursday</strong><br>
                <div class="session-card zone-sweetspot">
                    <strong>Zwift GainTrain – Sweet Spot</strong><br>
                    1.0h — 75 TSS<br>
                    Sweet Spot
                </div>
                </div><div class='day-column'><strong>Friday</strong><br><div class='session-card zone-rest'>Rest</div></div><div class='day-column'><strong>Saturday</strong><br>
                <div class="session-card zone-endurance">
                    <strong>Endurance Ride – 4h</strong><br>
                    4.0h — 180 TSS<br>
                    Endurance
                </div>
                </div><div class='day-column'><strong>Sunday</strong><br>
                <div class="session-card zone-tempo">
                    <strong>Tempo – 2h</strong><br>
                    2.0h — 95 TSS<br>
                    Tempo
                </div>
                </div></div><p><strong>Planned Intensity Summary:</strong> Balanced week with mixed intensities.</p>
        </div>

        
    <div class="card adaptive-changes">
        <h2>Adaptive Plan Changes</h2>
        <p>After adapting to your available time and current load:</p>
        <ul>
            <li>Kept WTRL Race – Zwift on Tuesday (fits time and TSS).</li><li>Kept Zwift GainTrain – Threshold on Thursday (fits time and TSS).</li><li>Kept Endurance Ride – 3.5h on Saturday (fits time and TSS).</li><li>Kept Endurance Ride – 2h on Sunday (fits time and TSS).</li>
        </ul>
        <p class="small">
            Remaining time budget: 1.2h<br>
            Remaining TSS gap: 51 TSS
        </p>
    </div>
    
        
        
    <div class="card adaptive-load-summary">
        <h2>Adaptive Load Summary</h2>
        <p><strong>Target TSS:</strong> 420</p><p><strong>Actual TSS:</strong> 84</p><p><strong>Status:</strong> <span class='badge status-bad'>Behind</span></p><p>You're under target — consider adding volume or intensity.</p><p><strong>Planned TSS:</strong> 560<br><strong>Adjusted TSS:</strong> 420<br>High fatigue detected — reducing next week's load.</p><h3>Suggested Sessions to Close Gap (6 TSS remaining)</h3><ul><li><strong>Threshold</strong> — Threshold – Z4 long intervals (120 TSS)</li><li><strong>Threshold</strong> — Threshold – Z4 long intervals (120 TSS)</li><li><strong>VO2 Max</strong> — VO2 – Z5 short intervals (90 TSS)</li></ul>
    </div>
    

        </div>
    </div>

    <script>
    function openTab(evt, tabId) {
        document.querySelectorAll('.tab-content').forEach(tab => {
            tab.classList.remove('active');
        });

        const target = document.getElementById(tabId);
        if (target) {
            target.classList.add('active');
        }

        document.querySelectorAll('.tab-button').forEach(btn => {
            btn.classList.remove('active');
        });
        evt.currentTarget.classList.add('active');
    }
    </script>

    <script>
    function toggleCard(id) {
        const content = document.getElementById(id);
        if (content.style.display === "none") {
            content.style.display = "block";
        } else {
            content.style.display = "none";
        }
    }
    </script>

<script>
async function loadTooltipPreview(workoutId) {
  const container = document.getElementById("tooltip-" + workoutId);
  if (!container) return;

  const jsonFile = container.dataset.json;

  try {
    const res = await fetch("/generated_workouts/" + jsonFile);
    if (!res.ok) {
      container.textContent = "No workout preview available.";
      return;
    }

    const data = await res.json();

    const totalMin = Math.round(data.total_duration_sec / 60);
    const tss = data.estimated_tss;
    const iff = data.estimated_if;

    let html = `
      <div class="workout-summary-line">
        <span>${totalMin} min</span>
        <span>IF ${iff.toFixed(2)}</span>
        <span>TSS ${tss.toFixed(0)}</span>
      </div>
      <hr style="border:0;border-top:1px solid #444;margin:6px 0;">
      <div class="workout-blocks">
    `;

    data.blocks.forEach(b => {
      const durMin = Math.round(b.duration_sec / 60);
      let powerText = "";

      if (b.power !== undefined) {
        powerText = `${Math.round(b.power * 100)}%`;
      } else if (b.power_low !== undefined && b.power_high !== undefined) {
        powerText = `${Math.round(b.power_low * 100)}–${Math.round(b.power_high * 100)}%`;
      }

      html += `
        <div class="workout-block">
          <div class="block-label">${b.type}</div>
          <div class="block-meta">${durMin} min · ${powerText}</div>
        </div>
      `;
    });

    html += `</div>`;
    container.innerHTML = html;

    // ----------------------------------------------------
    // MINI INLINE PREVIEW (correctly inside try block)
    // ----------------------------------------------------
    const inline = document.getElementById("inline-" + workoutId);
    if (inline) {
      inline.innerHTML = "";

      const total = data.total_duration_sec;

      data.blocks.forEach(b => {
        const width = (b.duration_sec / total) * 100;

        let cls = "inline-other";
        const t = b.type.toLowerCase();
        if (t.includes("warm")) cls = "inline-warmup";
        else if (t.includes("steady")) cls = "inline-steadystate";
        else if (t.includes("cool")) cls = "inline-cooldown";
        else if (t.includes("interval") || t.includes("sweet") || t.includes("threshold"))
          cls = "inline-interval";

        const div = document.createElement("div");
        div.className = "inline-block " + cls;
        div.style.flexGrow = b.duration_sec;

        inline.appendChild(div);
      });
    }

  } catch (e) {
    container.textContent = "Error loading preview.";
  }
}

document.addEventListener("DOMContentLoaded", () => {
  document.querySelectorAll(".tooltip-content").forEach(el => {
    const id = el.id.replace("tooltip-", "");
    loadTooltipPreview(id);
  });
});
</script>

</body>
</html>
